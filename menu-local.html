<!DOCTYPE html>
<html lang="es" data-environment="apk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Juegos Locales</title>
  <!-- Base necesaria para que los recursos relativos funcionen cuando se inyecta el HTML vía loadDataWithBaseURL -->
  <base href="file:///android_asset/" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin:0; background:#0d1117; color:#e6edf3; }
    header { background:#1f6feb; padding:16px; text-align:center; }
    h1 { margin:0; font-size:20px; }
    .grid { display:grid; gap:12px; padding:16px; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); }
    .card { background:#161b22; border:1px solid #30363d; border-radius:8px; padding:10px; cursor:pointer; position:relative; transition:.15s; }
    .card:hover { border-color:#1f6feb; box-shadow:0 0 0 2px #1f6feb44; }
    .card h2 { font-size:14px; margin:0 0 4px; line-height:1.2; }
    .card small { opacity:.7; font-size:11px; }
    #gameFrameWrapper { position:fixed; inset:0; background:#000; display:none; flex-direction:column; }
    #gameHeader { background:#1f6feb; padding:8px 12px; display:flex; align-items:center; gap:8px; }
    #gameHeader button { background:#0d1117; color:#e6edf3; border:1px solid #30363d; border-radius:6px; padding:6px 10px; cursor:pointer; }
    #gameHeader button:hover { background:#161b22; }
    iframe { flex:1; width:100%; border:0; background:#000; }
    #errorOverlay { position:fixed; inset:0; background:#000c; display:none; align-items:center; justify-content:center; }
    #errorOverlay .box { background:#161b22; border:1px solid #ff5555; padding:20px; max-width:360px; border-radius:10px; box-shadow:0 4px 20px #000; }
    #errorOverlay h3 { margin-top:0; color:#ff8888; }
    #errorDetails { white-space:pre-wrap; font-size:11px; background:#0d1117; padding:8px; border-radius:6px; max-height:200px; overflow:auto; }
  </style>
  <script>
  // Captura de errores globales para mostrarlos en overlay
  window.addEventListener('error', e => showError('Error JS', e.message + '\n' + (e.filename||'') + ':' + e.lineno));
  window.addEventListener('unhandledrejection', e => showError('Promise rechazada', String(e.reason)));
  function showError(title, details){
    const overlay = document.getElementById('errorOverlay');
    overlay.style.display='flex';
    overlay.querySelector('h3').textContent=title;
    document.getElementById('errorDetails').textContent=details;
  }
  const games = [
    { id:'4enraya', file:'script-4enraya.js', desc:'Conecta 4' },
    { id:'ahorcado', file:'script-ahorcado.js', desc:'Ahorcado' },
    { id:'arkanoid', file:'script-arkanoid.js', desc:'Arkanoid' },
    { id:'bubble', file:'script-bubble.js', desc:'Bubble' },
    { id:'laberinto', file:'script-laberinto.js', desc:'Laberinto' },
    { id:'memoria', file:'script-memoria.js', desc:'Memoria' },
    { id:'serpiente', file:'script-serpiente.js', desc:'Serpiente' },
    { id:'sokoban', file:'script-sokoban.js', desc:'Sokoban' },
    { id:'quiz', file:'script-quiz.js', desc:'Quiz' },
    { id:'flappy', file:'script-flappy.js', desc:'Flappy' },
    { id:'paracaidista', file:'script-paracaidista.js', desc:'Paracaidista' },
    { id:'recoge-moras', file:'script-recoge-moras.js', desc:'Recoge moras' },
    { id:'moto-desierto', file:'script-moto-desierto.js', desc:'Moto desierto' },
    { id:'nave-exploradora', file:'script-nave-exploradora.js', desc:'Nave exploradora' }
  ];
  function buildMenu(){
    const grid=document.getElementById('grid');
    games.forEach(g=>{
      const c=document.createElement('div');
      c.className='card';
      c.innerHTML='<h2>'+g.id+'</h2><small>'+g.desc+'</small>';
      c.onclick=()=>launchGame(g);
      grid.appendChild(c);
    });
    // Señal visual de que el menú se renderizó
    const dbg=document.getElementById('debugBanner');
    if(dbg) dbg.textContent+=' | menu listo';
  }
  function launchGame(g){
    const wrapper=document.getElementById('gameFrameWrapper');
    wrapper.style.display='flex';
    // We inject a blank html with dynamic script tag so no remote iframes
    const iframe=document.getElementById('gameFrame');
    const html = `<!DOCTYPE html><html lang='es'><head><meta charset='utf-8'><base href="file:///android_asset/"><title>${g.id}</title></head><body style="margin:0;background:#000;color:#fff;font-family:Arial">
      <div style="position:absolute;top:4px;left:6px;font:10px monospace;background:#1f6feb;padding:2px 4px;border-radius:4px;opacity:.7;z-index:99">Cargando ${g.file}</div>
      <canvas id='gameCanvas'></canvas>
      <script src='${g.file}' onerror="document.body.insertAdjacentHTML('beforeend','<div style=\\"position:absolute;top:24px;left:6px;background:#900;padding:4px;font:12px monospace\\">No se pudo cargar ${g.file}</div>')"></script>
      <script>console.log('[iframe] Juego ${g.id} inicializando'); window.initMobileControls && window.initMobileControls('directional');</script>
    </body></html>`;
    iframe.src = 'data:text/html;base64,'+btoa(unescape(encodeURIComponent(html)));
    const dbg=document.getElementById('debugBanner');
    if(dbg) dbg.textContent='Abriendo '+g.file;
  }
  function closeGame(){
    document.getElementById('gameFrameWrapper').style.display='none';
    document.getElementById('gameFrame').src='about:blank';
    const dbg=document.getElementById('debugBanner');
    if(dbg) dbg.textContent='Menú';
  }
  document.addEventListener('DOMContentLoaded', buildMenu);
  </script>
  <!-- Marcadores eliminados: los atributos data-* con punto no eran válidos y el filtrado impedía que aparecieran juegos -->
  <script src="mobile-controls.js"></script>
</head>
<body>
  <header><h1>Juegos Locales</h1></header>
  <div id="debugBanner" style="position:fixed;bottom:0;left:0;background:#1f6feb;color:#fff;font:10px monospace;padding:2px 4px;z-index:1000;border-top-right-radius:6px;opacity:.6">menu-local cargado</div>
  <div id="grid" class="grid"></div>
  <div id="gameFrameWrapper">
    <div id="gameHeader">
      <button onclick="closeGame()">⟵ Volver</button>
      <span style="font-weight:600">Juego</span>
    </div>
    <iframe id="gameFrame" title="game"></iframe>
  </div>
  <div id="errorOverlay"><div class="box"><h3>Error</h3><div id="errorDetails"></div><button onclick="this.parentNode.parentNode.style.display='none'">Cerrar</button></div></div>
</body>
</html>
