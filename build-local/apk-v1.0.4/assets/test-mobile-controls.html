<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>Test Mobile Controls</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        #gameCanvas {
            border: 1px solid #333;
            background: white;
            display: block;
            margin: 20px auto;
        }
        .test-info {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .test-passed { border-left: 5px solid #4CAF50; }
        .test-failed { border-left: 5px solid #f44336; }
        .test-warning { border-left: 5px solid #ff9800; }
    </style>
</head>
<body>
    <h1>üß™ Mobile Controls Test</h1>
    
    <canvas id="gameCanvas" width="400" height="300"></canvas>
    
    <div id="testResults">
        <div class="test-info">
            <strong>Running mobile controls tests...</strong>
        </div>
    </div>
    
    <div class="test-info">
        <h3>Manual Test Instructions:</h3>
        <ol>
            <li>Open this page on a mobile device or simulate touch in DevTools</li>
            <li>Mobile controls should appear automatically if touch is detected</li>
            <li>Try tapping the directional buttons - they should trigger key events</li>
            <li>Check the test results below</li>
        </ol>
    </div>

    <script src="mobile-controls.js"></script>
    <script>
        const testResults = document.getElementById('testResults');
        
        function addTestResult(title, passed, message) {
            const div = document.createElement('div');
            div.className = `test-info ${passed ? 'test-passed' : 'test-failed'}`;
            div.innerHTML = `<strong>${passed ? '‚úÖ' : '‚ùå'} ${title}</strong><br>${message}`;
            testResults.appendChild(div);
        }
        
        function addWarning(title, message) {
            const div = document.createElement('div');
            div.className = 'test-info test-warning';
            div.innerHTML = `<strong>‚ö†Ô∏è ${title}</strong><br>${message}`;
            testResults.appendChild(div);
        }
        
        // Test 1: Check if mobile controls object exists
        addTestResult('Mobile Controls Object', 
            window.mobileControls !== undefined, 
            window.mobileControls ? 'MobileControls instance found' : 'MobileControls instance not found');
        
        // Test 2: Check mobile detection
        if (window.mobileControls) {
            const isMobile = window.mobileControls.detectMobile();
            addTestResult('Mobile Detection', 
                true, // Always pass, just show the result
                `Device detected as: ${isMobile ? 'Mobile/Touch Device' : 'Desktop Device'}<br>
                User Agent: ${navigator.userAgent.substring(0, 50)}...<br>
                Touch Support: ${'ontouchstart' in window}<br>
                Max Touch Points: ${navigator.maxTouchPoints || 0}`);
        }
        
        // Test 3: Check initialization functions
        addTestResult('Initialization Functions', 
            typeof window.initMobileControls === 'function' && typeof window.cleanupMobileControls === 'function',
            'Global functions available for game integration');
        
        // Test 4: Try to initialize mobile controls
        if (window.mobileControls) {
            try {
                const canvas = document.getElementById('gameCanvas');
                window.mobileControls.init('directional', canvas);
                
                // Check if controls were created
                const controlsContainer = document.getElementById('mobileControls');
                addTestResult('Controls Initialization', 
                    controlsContainer !== null,
                    controlsContainer ? 'Mobile controls container created' : 'Mobile controls container not created');
                
                // Check if controls are visible on mobile
                if (controlsContainer) {
                    const isVisible = controlsContainer.style.display !== 'none';
                    addTestResult('Controls Visibility', 
                        true, // Just report status
                        `Controls display: ${controlsContainer.style.display || 'default'}<br>
                        Visible on this device: ${isVisible && window.mobileControls.isMobile ? 'Yes' : 'No (Desktop or hidden)'}`);
                }
                
            } catch (error) {
                addTestResult('Controls Initialization', false, `Error: ${error.message}`);
            }
        }
        
        // Test 5: Force show controls for testing (even on desktop)
        if (window.mobileControls && !window.mobileControls.isMobile) {
            addWarning('Desktop Testing', 
                'To test mobile controls on desktop, modify mobile-controls.js temporarily to force isMobile = true');
        }
        
        // Add a button to manually test mobile controls
        const testButton = document.createElement('button');
        testButton.textContent = 'üéÆ Force Show Mobile Controls (Test)';
        testButton.style.cssText = 'padding: 10px 20px; margin: 10px 0; font-size: 16px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;';
        testButton.onclick = function() {
            if (window.mobileControls) {
                // Temporarily force mobile mode for testing
                const originalIsMobile = window.mobileControls.isMobile;
                window.mobileControls.isMobile = true;
                
                try {
                    const canvas = document.getElementById('gameCanvas');
                    window.mobileControls.init('directional', canvas);
                    window.mobileControls.showControls();
                    addTestResult('Force Show Test', true, 'Mobile controls forced to show for testing');
                } catch (error) {
                    addTestResult('Force Show Test', false, `Error: ${error.message}`);
                } finally {
                    // Restore original mobile detection after 3 seconds
                    setTimeout(() => {
                        window.mobileControls.isMobile = originalIsMobile;
                        if (!originalIsMobile) {
                            window.mobileControls.hideControls();
                        }
                    }, 3000);
                }
            }
        };
        document.body.appendChild(testButton);
        
        // Listen for key events to verify controls work
        let keyEventCount = 0;
        document.addEventListener('keydown', function(e) {
            keyEventCount++;
            console.log('Key event detected:', e.key, e.keyCode);
            
            // Update canvas to show key press
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#333';
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`Key Pressed: ${e.key}`, canvas.width/2, canvas.height/2 - 20);
            ctx.fillText(`Total Key Events: ${keyEventCount}`, canvas.width/2, canvas.height/2 + 20);
        });
        
        // Initial canvas text
        setTimeout(() => {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#333';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Test Canvas', canvas.width/2, canvas.height/2 - 40);
            ctx.fillText('Touch controls should appear below', canvas.width/2, canvas.height/2);
            ctx.fillText('if on mobile device', canvas.width/2, canvas.height/2 + 20);
            ctx.fillText('Press controls to see key events', canvas.width/2, canvas.height/2 + 40);
        }, 100);
    </script>
</body>
</html>